@startuml SpaceInvaders_DiagramaClases

' ===================================
' DIAGRAMA DE CLASES - SPACE INVADERS MVC
' ===================================

skinparam classAttributeIconSize 0
skinparam packageStyle rectangle

' ==================== PACKAGE MODELO ====================
package modelo {
    
    ' Clase abstracta base
    abstract class ObjetoJuego {
        # x : int
        # y : int
        # ancho : int
        # alto : int
        # velocidad : int
        # limiteX : int
        # limiteY : int
        # observador : Observador
        + ObjetoJuego(x:int, y:int, velocidad:int)
        + setObservador(observador:Observador) : void
        + setLimites(limiteX:int, limiteY:int) : void
        + getX() : int
        + getY() : int
        + getAncho() : int
        + getAlto() : int
        # notificarCambio() : void
    }
    
    ' Clase abstracta para objetos actualizables
    abstract class ObjetoJuegoActualizable {
        + ObjetoJuegoActualizable(x:int, y:int, velocidad:int)
        + {abstract} actualizarPosicion() : void
    }
    
    ' Clases concretas del modelo
    class NaveJugador {
        - vida : int
        - {static} VIDA_MAXIMA : int = 100
        + NaveJugador(x:int, y:int, velocidad:int)
        + moverDerecha() : void
        + moverIzquierda() : void
        + disparar() : Rayo
        + recibirDano(cantidad:int) : void
        + getVida() : int
        + isDestruido() : boolean
        + reiniciarVida() : void
        - notificarCambioVida() : void
    }
    
    class Invasor {
        + Invasor(x:int, y:int, velocidad:int)
        + mover(dx:int, dy:int) : void
        + disparar() : Rayo
        + destruir() : void
    }
    
    class Rayo {
        - activo : boolean
        - esEnemigo : boolean
        + Rayo(x:int, y:int, velocidad:int, esEnemigo:boolean)
        + actualizarPosicion() : void
        + isActivo() : boolean
        + setActivo(activo:boolean) : void
        + isEnemigo() : boolean
        + destruir() : void
    }
    
    class Muro {
        - vida : int
        - destruido : boolean
        + Muro(x:int, y:int)
        + recibirDano(cantidad:int) : void
        + notificarCambio() : void
        + getVida() : int
        + isDestruido() : boolean
        + reiniciar() : void
    }
    
    ' Clase principal del modelo - Espacio
    class Espacio {
        - nave : NaveJugador
        - rayos : List<Rayo>
        - invasores : List<Invasor>
        - muros : List<Muro>
        - direccionInvasores : int = 1
        - velocidadInvasores : int = 2
        - puntaje : int = 0
        - nivel : int = 1
        - creditos : int = 1
        - gameOver : boolean = false
        - esperandoRepoblacion : boolean = false
        - nuevoRayoCallback : NuevoRayoCallback
        - dificultad : Dificultad
        + Espacio(dificultad:Dificultad)
        + setNuevoRayoCallback(callback:NuevoRayoCallback) : void
        - inicializarMuros() : void
        + setNave(nave:NaveJugador) : void
        + getNave() : NaveJugador
        + agregarInvasor(invasor:Invasor) : void
        + agregarRayo(rayo:Rayo) : void
        + agregarMuro(muro:Muro) : void
        + getMuros() : List<Muro>
        + actualizarPosiciones() : void
        - dispararEnemigos() : void
        + perderCredito() : void
        + isInvasoresEmpty() : boolean
        + setEsperandoRepoblacion(esperando:boolean) : void
        - moverInvasores() : void
        - verificarColisiones() : void
        - hayColision(obj1:ObjetoJuego, obj2:ObjetoJuego) : boolean
        - avanzarNivel() : void
        - verificarCreditosExtra() : void
        + getPuntaje() : int
        + getNivel() : int
        + getCreditos() : int
        + isGameOver() : boolean
        + setGameOver(gameOver:boolean) : void
        + getVelocidadInvasores() : int
    }
    
    ' Interface Callback
    interface "NuevoRayoCallback" as NuevoRayoCallback {
        + onNuevoRayoEnemigo(rayo:Rayo) : void
    }
    
    ' Interface Observador (patrón Observer)
    interface Observador {
        + mover(x:int, y:int) : void
        + getAncho() : int
        + getAlto() : int
        + actualizarEstado(vida:int, destruido:boolean) : void
    }
    
    ' Enum Dificultad
    enum Dificultad {
        CADETE(1)
        GUERRERO(2)
        MASTER(3)
        --
        - velocidadBase : int
        + getVelocidadBase() : int
        + getNombreCapitalizado() : String
    }
    
    ' Sistema de Ranking
    class Puntaje {
        - {static} serialVersionUID : long = 1L
        - nombre : String
        - puntos : int
        + Puntaje(nombre:String, puntos:int)
        + getNombre() : String
        + getPuntos() : int
        + compareTo(o:Puntaje) : int
    }
    
    class GestorRanking {
        - {static} ARCHIVO_RANKING : String = "ranking.dat"
        - {static} instancia : GestorRanking
        - puntajes : List<Puntaje>
        - GestorRanking()
        + {static} getInstancia() : GestorRanking
        + guardarPuntaje(nuevoPuntaje:Puntaje) : void
        + obtenerTop10() : List<Puntaje>
        - cargarRanking() : void
        - guardarEnArchivo() : void
    }
}

' ==================== PACKAGE CONTROLADOR ====================
package controlador {
    
    class JuegoController {
        - espacio : Espacio
        + JuegoController(espacio:Espacio)
        + JuegoController(dificultad:Dificultad)
        + moverNaveDerecha() : void
        + moverNaveIzquierda() : void
        + solicitarDisparo(observadorRayo:Observador) : void
        + actualizarJuego() : void
        + crearInvasor(x:int, y:int, observador:Observador) : void
        + setObservadorNave(observador:Observador) : void
        + inicializarMurosConObservadores(callback:ObservadorMuroCallback) : void
        + getPuntaje() : int
        + getNivel() : int
        + getCreditos() : int
        + isGameOver() : boolean
        + getVelocidadInvasores() : int
        + getVidaNave() : int
        + setCallbackRayosEnemigos(callback:NuevoRayoCallback) : void
        + verificarNivelCompletado() : boolean
    }
    
    interface "ObservadorMuroCallback" as ObservadorMuroCallback {
        + crearObservador(x:int, y:int) : Observador
    }
}

' ==================== PACKAGE VISTA ====================
package vista {
    
    ' Clase abstracta de vista
    abstract class ImagenObjetoJuego {
        + mover(x:int, y:int) : void
        + getAncho() : int
        + getAlto() : int
    }
    
    ' Implementaciones concretas de imagen
    class ImagenNave {
        + ImagenNave()
        + actualizarEstado(vida:int, destruido:boolean) : void
    }
    
    class ImagenInvasor {
        + ImagenInvasor()
    }
    
    class ImagenRayo {
        + ImagenRayo()
    }
    
    class ImagenRayoEnemigo {
        + ImagenRayoEnemigo()
    }
    
    class ImagenMuro {
        + ImagenMuro()
        + actualizarEstado(vida:int, destruido:boolean) : void
    }
    
    ' Paneles de la interfaz
    class PanelPrincipal {
        - controller : JuegoController
        - timer : Timer
        - lblPuntaje : JLabel
        - lblNivel : JLabel
        - lblCreditos : JLabel
        - lblVida : JLabel
        - fondo : FondoEstrellado
        - onShowRanking : Runnable
        - onShowMenu : Runnable
        + PanelPrincipal(controller:JuegoController, onShowRanking:Runnable, onShowMenu:Runnable)
        - actionPerformed(e:ActionEvent) : void
        # paintComponent(g:Graphics) : void
        - inicializarUI() : void
        - inicializarJuego() : void
        - crearInvasores() : void
        - inicializarEventos() : void
        - actualizarJuego() : void
        - manejarGameOver() : void
    }
    
    class PanelMenu {
        - onNuevoJuego : Runnable
        - onRanking : Runnable
        - onSalir : Runnable
        + PanelMenu(onNuevoJuego:Runnable, onRanking:Runnable, onSalir:Runnable)
    }
    
    class PanelDificultad {
        - dificultadSeleccionada : Dificultad
        - onConfirmar : Consumer<Dificultad>
        - onCancelar : Runnable
        + PanelDificultad(onConfirmar:Consumer<Dificultad>, onCancelar:Runnable)
    }
    
    class PanelRanking {
        - onVolver : Runnable
        + PanelRanking(onVolver:Runnable)
        - cargarRanking() : void
    }
    
    class PanelGameOver {
        + {static} mostrarDialogo(parent:Component, puntaje:int) : ResultadoGameOver
    }
    
    class "ResultadoGameOver" as ResultadoGameOver {
        + nombreJugador : String
        + verRanking : boolean
        + ResultadoGameOver(nombreJugador:String, verRanking:boolean)
    }
    
    class FondoEstrellado {
        - estrellas : List<Estrella>
        + FondoEstrellado(ancho:int, alto:int)
        + paint(g:Graphics, ancho:int, alto:int) : void
    }
    
    class BotonNeon {
        - colorNeon : Color
        - animacion : Timer
        - brillo : int
        + BotonNeon(texto:String)
    }
}

' ==================== PACKAGE PRINCIPAL ====================
package principal {
    
    class Principal {
        + {static} main(args:String[]) : void
    }
    
    class Ventana {
        - cardLayout : CardLayout
        - contentPanel : JPanel
        - controller : JuegoController
        + Ventana()
        - inicializarPaneles() : void
        - mostrarPanel(nombrePanel:String) : void
        + setCursor(cursor:Cursor) : void
    }
}

' ==================== RELACIONES ====================

' Herencia en modelo
ObjetoJuego <|-- ObjetoJuegoActualizable
ObjetoJuego <|-- NaveJugador
ObjetoJuego <|-- Invasor
ObjetoJuego <|-- Muro
ObjetoJuegoActualizable <|-- Rayo

' Composición y agregación en Espacio
Espacio "1" *-- "1" NaveJugador : contiene
Espacio "1" o-- "0..*" Invasor : gestiona
Espacio "1" o-- "0..*" Rayo : gestiona
Espacio "1" o-- "4" Muro : contiene
Espacio ..> Dificultad : usa
Espacio +-- NuevoRayoCallback

' Relación de Observador
ObjetoJuego ..> Observador : notifica
Observador <|.. ImagenObjetoJuego : implementa

' Herencia en vista
ImagenObjetoJuego <|-- ImagenNave
ImagenObjetoJuego <|-- ImagenInvasor
ImagenObjetoJuego <|-- ImagenRayo
ImagenObjetoJuego <|-- ImagenRayoEnemigo
ImagenObjetoJuego <|-- ImagenMuro

' Controlador
JuegoController "1" --> "1" Espacio : gestiona
JuegoController +-- ObservadorMuroCallback

' Vista - Controlador
PanelPrincipal "1" --> "1" JuegoController : usa
PanelPrincipal "1" *-- "1" FondoEstrellado : contiene
PanelPrincipal ..> ImagenNave : crea
PanelPrincipal ..> ImagenInvasor : crea
PanelPrincipal ..> ImagenRayo : crea
PanelPrincipal ..> ImagenRayoEnemigo : crea
PanelPrincipal ..> ImagenMuro : crea

' Ventana
Ventana "1" *-- "1" PanelMenu : contiene
Ventana "1" *-- "1" PanelDificultad : contiene
Ventana "1" *-- "1" PanelPrincipal : contiene
Ventana "1" *-- "1" PanelRanking : contiene
Ventana "1" --> "1" JuegoController : delega

' Ranking
GestorRanking "1" o-- "0..10" Puntaje : gestiona
PanelGameOver +-- ResultadoGameOver
PanelGameOver ..> GestorRanking : usa
PanelRanking ..> GestorRanking : usa
Puntaje ..|> Comparable : implementa
Puntaje ..|> Serializable : implementa

' Principal
Principal ..> Ventana : inicia

' JLabel (de javax.swing)
ImagenObjetoJuego --|> JLabel
PanelPrincipal --|> JPanel
PanelMenu --|> JPanel
PanelDificultad --|> JPanel
PanelRanking --|> JPanel
BotonNeon --|> JButton

' Notas explicativas
note right of Espacio
  Clase central del modelo.
  Gestiona toda la lógica del juego:
  - Movimiento de invasores
  - Colisiones
  - Puntajes y niveles
  - Estado del juego
end note

note right of JuegoController
  Implementa el patrón MVC.
  Intermedia entre el modelo
  (Espacio) y la vista
  (PanelPrincipal).
end note

note right of Observador
  Patrón Observer para
  sincronizar modelo y vista.
  Los objetos del modelo
  notifican cambios a sus
  observadores en la vista.
end note

note left of ImagenObjetoJuego
  Clases de vista que
  implementan Observador.
  Se actualizan cuando
  el modelo cambia.
end note

@enduml
